<!DOCTYPE html>
<html>
<head>
<title>勇者の終わりなき旅</title>
<script type="application/javascript">

/* キー操作用 */
let flagKeyDown = false;


const SHITA = 7;
const UE = 8;
const MIGI = 9;
const HIDARI = 10;

const YAMA = 4;
const UMI = 2;
const IWA = 11;
const UZU = 16;
const NUMA = 19;

let chara_direct = SHITA;
let chara_x = 5;
let chara_y = 5;

const map_width = 20;
const map_height = 20;

let imgTown = new Image();
let imgNohara = new Image();
let imgYama = new Image();
let imgUmi = new Image();
let imgSabaku = new Image();
let imgMori = new Image();
let imgDoukutu = new Image();
let imgShita = new Image();
let imgUe = new Image();
let imgMigi = new Image();
let imgHidari = new Image();
let imgIwa = new Image();
let imgKusa = new Image();
let imgTownSabaku = new Image();
let imgTouUe = new Image();
let imgTouShita = new Image();
let imgUzu = new Image();
let imgFune = new Image();
let imgVillage = new Image();
let imgNuma = new Image();
let imgShindenHidari = new Image();
let imgShindenMigi = new Image();
let imgShiroHidariUe = new Image();
let imgShiroHidariShita = new Image();
let imgShiroMigiUe = new Image();
let imgShiroMigiShita = new Image();
let ctx;



onload = function() {
	let flagShiroHidariUe = false;
	imgShiroHidariUe.src = "images/ffshirohidariue.png";
	imgShiroHidariUe.onload = function() {
		flagShiroHidariUe = true;
	};
	let flagShiroHidariShita = false;
	imgShiroHidariShita.src = "images/ffshirohidarishita.png";
	imgShiroHidariShita.onload = function() {
		flagShiroHidariShita = true;
	};
	let flagShiroMigiUe = false;
	imgShiroMigiUe.src = "images/ffshiromigiue.png";
	imgShiroMigiUe.onload = function() {
		flagShiroMigiUe = true;
	};
	let flagShiroMigiShita = false;
	imgShiroMigiShita.src = "images/ffshiromigishita.png";
	imgShiroMigiShita.onload = function() {
		flagShiroMigiShita = true;
	};
	let flagShindenHidari = false;
	imgShindenHidari.src = "images/ffshindenhidari.png";
	imgShindenHidari.onload = function() {
		flagShindenHidari = true;
	};
	let flagShindenMigi = false;
	imgShindenMigi.src = "images/ffshindenmigi.png";
	imgShindenMigi.onload = function() {
		flagShindenMigi = true;
	};
	let flagNuma = false;
	imgNuma.src = "images/ffnuma.png";
	imgNuma.onload = function() {
		flagNuma = true;
	};
	let flagVillage = false;
	imgVillage.src = "images/ffvillage.png";
	imgVillage.onload = function() {
		flagVillage = true;
	};
	let flagFune = false;
	imgFune.src = "images/fffune.png";
	imgFune.onload = function() {
		flagFune = true;
	};
	let flagUzu = false;
	imgUzu.src = "images/ffuzu.png";
	imgUzu.onload = function() {
		flagUzu = true;
	};
	let flagTouUe = false;
	imgTouUe.src = "images/fftouue.png";
	imgTouUe.onload = function() {
		flagTouUe = true;
	};
	let flagTouShita = false;
	imgTouShita.src = "images/fftoushita.png";
	imgTouShita.onload = function() {
		flagTouShita = true;
	};
	idField = document.getElementById('field');
	idStatus = document.getElementById('status') ;
	ctx = idField.getContext('2d');

	let flagTownSabaku = false;
	imgTownSabaku.src = "images/fftown_sabaku.png";
	imgTownSabaku.onload = function() {
		flagTownSabaku = true;
	};
	let flagKusa = false;
	imgKusa.src = "images/ffkusa.png";
	imgKusa.onload = function() {
		flagKusa = true;
	};
	let flagTown = false;
	imgTown.src = "images/fftown.png";
	imgTown.onload = function() {
		flagTown = true;
	};
	imgNohara.src = "images/ffnohara.png";
	let flagNohara = false;
	imgNohara.onload = function() {
		flagNohara = true;
	};
	imgYama.src = "images/ffyama.png";	
	let flagYama = false;
	imgYama.onload = function() {
		flagYama = true;
	};
	imgMigi.src = "images/ffmigi.png";
	imgMigi.onload = function() {
	};
	let flagUmi = false;
	imgUmi.src = "images/ffumi.png";
	imgUmi.onload = function() {
		flagUmi = true;
	};
	let flagSabaku = false;
	imgSabaku.src = "images/ffsabaku.png";
	imgSabaku.onload = function() {
		flagSabaku = true;
	};
	let flagMori = false;
	imgMori.src = "images/ffmori.png";
	imgMori.onload = function() {
		flagMori = true;
	};
	let flagDoukutu = false;
	imgDoukutu.src = "images/ffdoukutu.png";
	imgDoukutu.onload = function() {
		flagDoukutu = true;
	};
	let flagIwa = false;
	imgIwa.src = "images/ffiwa.png";
	imgIwa.onload = function() {
		flagIwa = true;
	};
	let flagShita = false;
	imgShita.src = "images/ffshita.png";
	imgShita.onload = function() {
		flagShita = true;
	};
	let flagUe = false;
	imgUe.src = "images/ffue.png";
	imgUe.onload = function() {
		flagUe = true;
	};
	let flagMigi = false;
	imgMigi.src = "images/ffmigi.png";
	imgMigi.onload = function() {
		flagMigi = true;
	};
	let flagHidari = false;
	imgHidari.src = "images/ffhidari.png";
	imgHidari.onload = function() {
		flagHidari = true;
	};
	let hoge = setInterval(function(){
		clearInterval(hoge);
		if(flagMori && flagSabaku && flagTown && flagUmi && flagNohara && flagYama) {
			start();
		} else {
			console.log("Image Load Error.");
		};
	},500);
};


function start() {
	const map = [];
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,1,0,5,5,5,5,5,4,4,4,4,2,2,2,2]);
	map.push([2,2,2,2,2,0,5,5,5,5,5,5,5,4,6,4,2,2,2,2]);
	map.push([2,2,2,2,2,0,2,2,2,2,2,2,5,4,0,4,2,2,2,2]);
	map.push([2,2,2,2,2,16, 2,20,21, 2, 2, 2, 5, 4,19, 4,2,2,2,2]);
	map.push([2,2,2,2,2,12, 2, 2, 2, 2,17, 2, 5, 4, 0, 4,2,2,2,2]);
	map.push([2,2,2,2,2,12,12,12,12,14,12, 2, 5, 4,18, 4,2,2,2,2]);
	map.push([2,2,2,2,2, 4, 4, 4,12,15,12, 2, 5, 4, 4, 4,2,2,2,2]);
	map.push([2,2,2,2,2, 4, 6, 4,12,12,12, 2, 3, 3, 3, 4,2,2,2,2]);
	map.push([2,2,2,2,2, 4, 3, 4, 4, 4, 4, 4, 3,22,24, 4,2,2,2,2]);
	map.push([2,2,2,2,2, 4,11, 3, 3, 3, 3,11, 3,23,25, 4,2,2,2,2]);
	map.push([2,2,2,2,2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	const images = [ ];
	images.push(imgNohara);
	images.push(imgTown);
	images.push(imgUmi);
	images.push(imgSabaku);
	images.push(imgYama);
	images.push(imgMori);
	images.push(imgDoukutu);
	images.push(imgShita);
	images.push(imgUe);
	images.push(imgMigi);
	images.push(imgHidari);
	images.push(imgIwa);
	images.push(imgKusa);
	images.push(imgTownSabaku);
	images.push(imgTouUe);
	images.push(imgTouShita);
	images.push(imgUzu);
	images.push(imgFune);
	images.push(imgVillage);
	images.push(imgNuma);
	images.push(imgShindenHidari);
	images.push(imgShindenMigi);
	images.push(imgShiroHidariUe);
	images.push(imgShiroHidariShita);
	images.push(imgShiroMigiUe);
	images.push(imgShiroMigiShita);



	/* マップを描く */
	const drawMap = function() {
		for(let jj = 0;jj < 10;jj++) {
			for(let ii = 0;ii < 10;ii++) {
				ctx.drawImage(images[map[jj+chara_y-5][ii+chara_x-5]],64*ii,64*jj);
			};
		}
	};
	drawMap();
	ctx.drawImage(images[chara_direct],64*5,64*5);
	/* キャクターを描く */
	document.addEventListener('keydown',(event) => {
		if(flagKeyDown == false) {
			let number = -1;
			if(event.key == '2') {
				number = SHITA;
				if (chara_y+5<20 && map[chara_y+1][chara_x] != YAMA && map[chara_y+1][chara_x] != UMI && map[chara_y+1][chara_x] != UZU) {
					chara_y++;
				}
			}
			if(event.key == '8') {
				number = UE;
				if (chara_y-5>0 && map[chara_y-1][chara_x] != YAMA && map[chara_y-1][chara_x] != UMI) {
					chara_y--;
				}
			}
			if(event.key == '6') {
				number = MIGI;
				if (chara_x+5<20 && map[chara_y][chara_x+1] != YAMA && map[chara_y][chara_x+1] != UMI) {
					chara_x++;
				}
			}
			if(event.key == '4') {
				number = HIDARI;
				if (chara_x-5>0 && map[chara_y][chara_x-1] != YAMA && map[chara_y][chara_x-1] != UMI && map[chara_y][chara_x-1] != IWA) {
					chara_x--;
				}
			}
			if(number != -1){
			drawMap();
				 chara_direct = number;
			}
			ctx.drawImage(images[chara_direct],64*5,64*5);
			flagKeyDown = true;
		}
	},false);
	document.addEventListener('keyup',(event) => {
		flagKeyDown = false;
	},false);
};
</script>
</body>
<canvas id="field" width="640px" height="640px"></canvas>
<div id="status"></div>
</body>
</html>
