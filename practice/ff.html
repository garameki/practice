<!DOCTYPE html>
<html>
<head>
<title>勇者の終わりなき旅</title>
<script type="application/javascript">

/* キー操作用 */
let flagKeyDown = false;


const SHITA = 7;
const UE = 8;
const MIGI = 9;
const HIDARI = 10;

const YAMA = 4;
const UMI = 2;

let chara_direct = SHITA;
let chara_x = 5;
let chara_y = 5;

const map_width = 20;
const map_height = 20;

let imgTown = new Image();
let imgNohara = new Image();
let imgYama = new Image();
let imgUmi = new Image();
let imgSabaku = new Image();
let imgMori = new Image();
let imgDoukutu = new Image();
let imgShita = new Image();
let imgUe = new Image();
let imgMigi = new Image();
let imgHidari = new Image();
let ctx;



onload = function() {
	idField = document.getElementById('field');
	idStatus = document.getElementById('status') ;
	ctx = idField.getContext('2d');
	let flagTown = false;
	imgTown.src = "images/fftown.png";
	imgTown.onload = function() {
		flagTown = true;
	};
	imgNohara.src = "images/ffnohara.png";
	let flagNohara = false;
	imgNohara.onload = function() {
		flagNohara = true;
	};
	imgYama.src = "images/ffyama.png";	
	let flagYama = false;
	imgYama.onload = function() {
		flagYama = true;
	};
	imgMigi.src = "images/ffmigi.png";
	imgMigi.onload = function() {
	};
	let flagUmi = false;
	imgUmi.src = "images/ffumi.png";
	imgUmi.onload = function() {
		flagUmi = true;
	};
	let flagSabaku = false;
	imgSabaku.src = "images/ffsabaku.png";
	imgSabaku.onload = function() {
		flagSabaku = true;
	};
	let flagMori = false;
	imgMori.src = "images/ffmori.png";
	imgMori.onload = function() {
		flagMori = true;
	};
	let flagDoukutu = false;
	imgDoukutu.src = "images/ffdoukutu.png";
	imgDoukutu.onload = function() {
		flagDoukutu = true;
	};
	let flagShita = false;
	imgShita.src = "images/ffshita.png";
	imgShita.onload = function() {
		flagShita = true;
	};
	let flagUe = false;
	imgUe.src = "images/ffue.png";
	imgUe.onload = function() {
		flagUe = true;
	};
	let flagMigi = false;
	imgMigi.src = "images/ffmigi.png";
	imgMigi.onload = function() {
		flagMigi = true;
	};
	let flagHidari = false;
	imgHidari.src = "images/ffhidari.png";
	imgHidari.onload = function() {
		flagHidari = true;
	};
	let hoge = setInterval(function(){
		clearInterval(hoge);
		if(flagMori && flagSabaku && flagTown && flagUmi && flagNohara && flagYama) {
			start();
		} else {
			console.log("Image Load Error.");
		};
	},500);
};


function start() {
	const map = [];
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,3,4,5,5,0,0,0,0,0,0,0,2,2,2,2]);
	map.push([2,2,2,2,2,3,4,5,5,0,0,0,0,0,0,0,2,2,2,2]);
	map.push([2,2,2,2,2,0,5,0,0,0,0,0,0,0,0,0,2,2,2,2]);
	map.push([2,2,2,2,2,0,5,0,0,0,0,0,0,0,0,0,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,0,0,0,0,0,1,0,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,5,5,5,0,0,0,0,2,2,2,2]);
	map.push([2,2,2,2,2,5,5,5,5,5,5,5,0,0,0,0,2,2,2,2]);
	map.push([2,2,2,2,2,4,5,5,5,5,5,5,5,0,0,0,2,2,2,2]);
	map.push([2,2,2,2,2,6,4,5,5,5,5,5,5,0,0,0,2,2,2,2]);
	map.push([2,2,2,2,2,1,4,5,5,0,0,0,0,0,0,0,2,2,2,2]);
	map.push([2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	map.push([2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);
	const images = [ ];
	images.push(imgNohara);
	images.push(imgTown);
	images.push(imgUmi);
	images.push(imgSabaku);
	images.push(imgYama);
	images.push(imgMori);
	images.push(imgDoukutu);
	images.push(imgShita);
	images.push(imgUe);
	images.push(imgMigi);
	images.push(imgHidari);



	/* マップを描く */
	const drawMap = function() {
		for(let jj = 0;jj < 10;jj++) {
			for(let ii = 0;ii < 10;ii++) {
				ctx.drawImage(images[map[jj+chara_y-5][ii+chara_x-5]],64*ii,64*jj);
			};
		}
	};
	drawMap();
	ctx.drawImage(images[chara_direct],64*5,64*5);
	/* キャクターを描く */
	document.addEventListener('keydown',(event) => {
		if(flagKeyDown == false) {
			let number = -1;
			if(event.key == '2') {
				number = SHITA;
				if (chara_y+5<20 && map[chara_y+1][chara_x] != YAMA && map[chara_y+1][chara_x] != UMI) {
					chara_y++;
				}
			}
			if(event.key == '8') {
				number = UE;
				if (chara_y-5>0 && map[chara_y-1][chara_x] != YAMA && map[chara_y-1][chara_x] != UMI) {
					chara_y--;
				}
			}
			if(event.key == '6') {
				number = MIGI;
				if (chara_x+5<20 && map[chara_y][chara_x+1] != YAMA && map[chara_y][chara_x+1] != UMI) {
					chara_x++;
				}
			}
			if(event.key == '4') {
				number = HIDARI;
				if (chara_x-5>0 && map[chara_y][chara_x-1] != YAMA && map[chara_y][chara_x-1] != UMI) {
					chara_x--;
				}
			}
			if(number != -1){
			drawMap();
				 chara_direct = number;
			}
			ctx.drawImage(images[chara_direct],64*5,64*5);
			flagKeyDown = true;
		}
	},false);
	document.addEventListener('keyup',(event) => {
		flagKeyDown = false;
	},false);
};
</script>
</body>
<canvas id="field" width="640px" height="640px"></canvas>
<div id="status"></div>
</body>
</html>
